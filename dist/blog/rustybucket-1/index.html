<!DOCTYPE html>
<html lang="en" class="astro-37FXCHFA">
<head>
  <!-- Global Metadata --><meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<link rel="icon" type="image/x-icon" href="/favicon.ico">


<!-- Primary Meta Tags -->
<title>Building Rusty Bucket - Part 1</title>
<meta name="title" content="Building Rusty Bucket - Part 1">
<meta name="description" content="Rusty the bucket a performance benchmark for building pandas">

<!-- Open Graph / Facebook -->
<meta property="og:type" content="website">
<meta property="og:url" content="https://astro-blog-template.netlify.app/rustybucket-1">
<meta property="og:title" content="Building Rusty Bucket - Part 1">
<meta property="og:description" content="Rusty the bucket a performance benchmark for building pandas">
<meta property="og:image" content="https://astro-blog-template.netlify.app/assets/social.png">

<!-- Twitter -->
<meta property="twitter:card" content="summary_large_image">
<meta property="twitter:url" content="https://astro-blog-template.netlify.app/rustybucket-1">
<meta property="twitter:title" content="Building Rusty Bucket - Part 1">
<meta property="twitter:description" content="Rusty the bucket a performance benchmark for building pandas">
<meta property="twitter:image" content="https://astro-blog-template.netlify.app/assets/social.png">

<!-- This is intentionally inlined to avoid FOUC -->

<link rel="stylesheet" href="/_astro/about.1d73de66.css" />
<link rel="stylesheet" href="/_astro/_slug_.6402d670.css" /><script type="module">const e=document.documentElement,t=localStorage.getItem("theme");t==="dark"||!t&&window.matchMedia("(prefers-color-scheme: dark)").matches?e.classList.add("theme-dark"):e.classList.remove("theme-dark");
</script></head>
<body class="astro-37FXCHFA">
  <div class="layout astro-37FXCHFA">
    

<header class="astro-3EF6KSR2">
  

<a href="/" class="astro-TVRURPNS">
  <img alt="Blog Logo" src="/assets/logo.png" width="75" height="50" class="astro-TVRURPNS">
</a>
  

<nav class="astro-DMQPWCEC">
  <a class=" astro-DMQPWCEC" href="/">home</a>
  <a class=" astro-DMQPWCEC" href="/about">about</a>
  <a class="selected astro-DMQPWCEC" href="/blog">blog</a>
  <div class="theme-toggle-container astro-DMQPWCEC">
    <style>astro-island,astro-slot{display:contents}</style><script>(self.Astro=self.Astro||{}).load=a=>{(async()=>await(await a())())()},window.dispatchEvent(new Event("astro:load"));var l;{const c={0:t=>t,1:t=>JSON.parse(t,o),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(JSON.parse(t,o)),5:t=>new Set(JSON.parse(t,o)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(JSON.parse(t)),9:t=>new Uint16Array(JSON.parse(t)),10:t=>new Uint32Array(JSON.parse(t))},o=(t,s)=>{if(t===""||!Array.isArray(s))return s;const[e,n]=s;return e in c?c[e](n):void 0};customElements.get("astro-island")||customElements.define("astro-island",(l=class extends HTMLElement{constructor(){super(...arguments);this.hydrate=()=>{if(!this.hydrator||this.parentElement&&this.parentElement.closest("astro-island[ssr]"))return;const s=this.querySelectorAll("astro-slot"),e={},n=this.querySelectorAll("template[data-astro-template]");for(const r of n){const i=r.closest(this.tagName);!i||!i.isSameNode(this)||(e[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(const r of s){const i=r.closest(this.tagName);!i||!i.isSameNode(this)||(e[r.getAttribute("name")||"default"]=r.innerHTML)}const a=this.hasAttribute("props")?JSON.parse(this.getAttribute("props"),o):{};this.hydrator(this)(this.Component,a,e,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),window.removeEventListener("astro:hydrate",this.hydrate),window.dispatchEvent(new CustomEvent("astro:hydrate"))}}connectedCallback(){!this.hasAttribute("await-children")||this.firstChild?this.childrenConnectedCallback():new MutationObserver((s,e)=>{e.disconnect(),this.childrenConnectedCallback()}).observe(this,{childList:!0})}async childrenConnectedCallback(){window.addEventListener("astro:hydrate",this.hydrate);let s=this.getAttribute("before-hydration-url");s&&await import(s),this.start()}start(){const s=JSON.parse(this.getAttribute("opts")),e=this.getAttribute("client");if(Astro[e]===void 0){window.addEventListener(`astro:${e}`,()=>this.start(),{once:!0});return}Astro[e](async()=>{const n=this.getAttribute("renderer-url"),[a,{default:r}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),i=this.getAttribute("component-export")||"default";if(!i.includes("."))this.Component=a[i];else{this.Component=a;for(const d of i.split("."))this.Component=this.Component[d]}return this.hydrator=r,this.hydrate},s,this)}attributeChangedCallback(){this.hydrator&&this.hydrate()}},l.observedAttributes=["props"],l))}</script><astro-island uid="lJg73" component-url="/_astro/ThemeToggleButton.be461bb1.js" component-export="default" renderer-url="/_astro/client.c4e17359.js" props="{&quot;class&quot;:[0,&quot;astro-DMQPWCEC&quot;]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;ThemeToggleButton&quot;,&quot;value&quot;:true}" await-children=""><div class="theme-toggle"><label class=""><!-- HTML_TAG_START --><svg
      xmlns="http://www.w3.org/2000/svg"
      width="20"
      height="20"
      viewBox="0 0 20 20"
      fill="currentColor"
    >
      <path
        fill-rule="evenodd"
        d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z"
        clip-rule="evenodd"
      />
    </svg><!-- HTML_TAG_END -->
      <input type="radio" name="theme-toggle"  value="light" title="Use light theme" aria-label="Use light theme">
    </label><label class=""><!-- HTML_TAG_START --><svg
      xmlns="http://www.w3.org/2000/svg"
      width="20"
      height="20"
      viewBox="0 0 20 20"
      fill="currentColor"
    >
      <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z" />
    </svg><!-- HTML_TAG_END -->
      <input type="radio" name="theme-toggle"  value="dark" title="Use dark theme" aria-label="Use dark theme">
    </label></div></astro-island>
  </div>
</nav>
</header>

    <main class="astro-37FXCHFA">
      <header class="astro-4SN4ZG3R">
    <p class="astro-4SN4ZG3R">2023-03-11 ~ 5 min read</p>
    <h1 class="astro-4SN4ZG3R">Building Rusty Bucket - Part 1</h1>
    <hr class="astro-4SN4ZG3R">
  </header><div class="container astro-4SN4ZG3R">
    <article class="content astro-4SN4ZG3R">
      <h1 id="building-rusty-bucket---part-1">Building Rusty Bucket - Part 1</h1>
<h3 id="table-of-contents">Table of Contents</h3>
<ul>
<li>Introduction</li>
<li>Goals</li>
<li>Non-goals</li>
<li>Implementation</li>
<li>Benchmarking</li>
<li>Continuous Integration</li>
<li>The Well-Used Bucket (Story)</li>
</ul>
<p>In this series of blog posts, Iâ€™ll chronicle my journey building aÂ <code>pandas</code>-inspiredÂ data analysis libraryÂ in Rust calledÂ <code>rustybucket</code> with some name brainstorming power thanks to @functorism. Today, weâ€™ll focus on the coreÂ <code>Series</code>Â data structureÂ and benchmark its performance.</p>
<p><a href="https://github.com/eleijonmarck/rustybucket" target="_blank" rel="nofollow">https://github.com/eleijonmarck/rustybucket</a> - â­</p>
<h2 id="introduction">Introduction</h2>
<p>I useÂ <code>pandas</code>Â extensively in both my professional andÂ personal data analysisÂ work, and I wanted to learn more about Rust by implementing core pieces ofÂ <code>pandas</code>â€™ functionality. My goal forÂ <code>rustybucket</code>Â is to have aÂ solid subsetÂ ofÂ <code>pandas</code>â€™Â APIÂ implemented in Rust, allowing for exploration of Rustâ€™sÂ performance characteristicsÂ and my own learnings along the way.</p>
<p>For part 1, Iâ€™m focusing on implementingÂ <code>rustybucket</code>â€™sÂ <code>Series</code>Â - aÂ homogenous arrayÂ of data with an associated index - andÂ benchmarking basic operationsÂ on the structure.</p>
<h3 id="goals">Goals</h3>
<ul>
<li>Learn more about Rust and its ecosystem</li>
<li>Implement aÂ <code>Series</code>Â struct with indexing/slicing</li>
<li>Write benchmarks to measure performance of coreÂ <code>Series</code>Â operations</li>
</ul>
<h3 id="non-goals">Non-goals</h3>
<ul>
<li>FullÂ <code>pandas</code>Â API coverageÂ (for now)</li>
<li>DataFrame or other higher-order structures</li>
</ul>
<h2 id="implementation">Implementation</h2>
<p>I started by setting up a newÂ Rust libraryÂ withÂ <code>cargo new rustybucket --lib</code>. Since this is a library and not an executable, we donâ€™t need aÂ <code>main</code>Â function.</p>
<p>For theÂ <code>Series</code>Â implementation, I had to decide between using aÂ <code>Vec</code>Â (owning,Â resizable array) or aÂ <code>&#x26;[T]</code>Â slice (borrowed slice of elements). Since we may want to concatenateÂ <code>Series</code>Â together or adjust capacity,Â <code>Vec</code>Â seemed like the clearer choice for now. Hereâ€™s the currentÂ <code>Series</code>Â struct:</p>
<pre is:raw="" class="astro-code" style="background-color: #2e3440ff; overflow-x: auto;"><code><span class="line"><span style="color: #81A1C1">pub</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">struct</span><span style="color: #D8DEE9FF"> </span><span style="color: #8FBCBB">Series</span><span style="color: #ECEFF4">&#x3C;</span><span style="color: #8FBCBB">T</span><span style="color: #ECEFF4">></span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">{</span></span>
<span class="line"><span style="color: #D8DEE9FF">    </span><span style="color: #D8DEE9">name</span><span style="color: #81A1C1">:</span><span style="color: #D8DEE9FF"> </span><span style="color: #8FBCBB">String</span><span style="color: #ECEFF4">,</span></span>
<span class="line"><span style="color: #D8DEE9FF">    </span><span style="color: #D8DEE9">data</span><span style="color: #81A1C1">:</span><span style="color: #D8DEE9FF"> </span><span style="color: #8FBCBB">Vec</span><span style="color: #ECEFF4">&#x3C;</span><span style="color: #8FBCBB">T</span><span style="color: #ECEFF4">>,</span></span>
<span class="line"><span style="color: #ECEFF4">}</span></span></code></pre>
<p>To enable indexing and slicing, I implementedÂ <code>Index</code>Â andÂ <code>Slice</code>Â traits forÂ <code>Series</code>.</p>
<p>With theÂ core structÂ and traits in place, it was time to write some benchmarks! I used theÂ <a href="https://crates.io/crates/criterion" target="_blank" rel="nofollow"><code>criterion</code></a>Â crate toÂ benchmark basic slicing operationsÂ on myÂ <code>Series</code>.</p>
<pre is:raw="" class="astro-code" style="background-color: #2e3440ff; overflow-x: auto;"><code><span class="line"><span style="color: #81A1C1">use</span><span style="color: #D8DEE9FF"> criterion</span><span style="color: #81A1C1">::</span><span style="color: #ECEFF4">{</span><span style="color: #D8DEE9FF">criterion_group</span><span style="color: #ECEFF4">,</span><span style="color: #D8DEE9FF"> criterion_main</span><span style="color: #ECEFF4">,</span><span style="color: #D8DEE9FF"> </span><span style="color: #8FBCBB">Criterion</span><span style="color: #ECEFF4">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #81A1C1">fn</span><span style="color: #D8DEE9FF"> </span><span style="color: #88C0D0">slice_series</span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9">s</span><span style="color: #81A1C1">:</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">&#x26;</span><span style="color: #8FBCBB">Series</span><span style="color: #ECEFF4">&#x3C;</span><span style="color: #8FBCBB">i32</span><span style="color: #ECEFF4">>,</span><span style="color: #D8DEE9FF"> </span><span style="color: #D8DEE9">start</span><span style="color: #81A1C1">:</span><span style="color: #D8DEE9FF"> </span><span style="color: #8FBCBB">usize</span><span style="color: #ECEFF4">,</span><span style="color: #D8DEE9FF"> </span><span style="color: #D8DEE9">end</span><span style="color: #81A1C1">:</span><span style="color: #D8DEE9FF"> </span><span style="color: #8FBCBB">usize</span><span style="color: #ECEFF4">)</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">{</span></span>
<span class="line"><span style="color: #D8DEE9FF">    </span><span style="color: #81A1C1">let</span><span style="color: #D8DEE9FF"> </span><span style="color: #D8DEE9">_</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">&#x26;</span><span style="color: #D8DEE9">s</span><span style="color: #ECEFF4">[</span><span style="color: #D8DEE9">start</span><span style="color: #81A1C1">..</span><span style="color: #D8DEE9">end</span><span style="color: #ECEFF4">];</span></span>
<span class="line"><span style="color: #ECEFF4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #81A1C1">fn</span><span style="color: #D8DEE9FF"> </span><span style="color: #88C0D0">criterion_benchmark</span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9">c</span><span style="color: #81A1C1">:</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">&#x26;mut</span><span style="color: #D8DEE9FF"> </span><span style="color: #8FBCBB">Criterion</span><span style="color: #ECEFF4">)</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">{</span></span>
<span class="line"><span style="color: #D8DEE9FF">    </span><span style="color: #81A1C1">let</span><span style="color: #D8DEE9FF"> </span><span style="color: #D8DEE9">s</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #8FBCBB">Series</span><span style="color: #81A1C1">::</span><span style="color: #88C0D0">new</span><span style="color: #ECEFF4">(</span><span style="color: #8FBCBB">String</span><span style="color: #81A1C1">::</span><span style="color: #88C0D0">from</span><span style="color: #ECEFF4">(</span><span style="color: #ECEFF4">"</span><span style="color: #A3BE8C">example</span><span style="color: #ECEFF4">"</span><span style="color: #ECEFF4">),</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">(</span><span style="color: #B48EAD">0</span><span style="color: #81A1C1">..</span><span style="color: #B48EAD">1000</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">.</span><span style="color: #88C0D0">collect</span><span style="color: #ECEFF4">());</span></span>
<span class="line"><span style="color: #D8DEE9FF">    </span><span style="color: #D8DEE9">c</span><span style="color: #81A1C1">.</span><span style="color: #88C0D0">bench_function</span><span style="color: #ECEFF4">(</span><span style="color: #ECEFF4">"</span><span style="color: #A3BE8C">slice series</span><span style="color: #ECEFF4">"</span><span style="color: #ECEFF4">,</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">|</span><span style="color: #D8DEE9">b</span><span style="color: #81A1C1">|</span><span style="color: #D8DEE9FF"> </span><span style="color: #D8DEE9">b</span><span style="color: #81A1C1">.</span><span style="color: #88C0D0">iter</span><span style="color: #ECEFF4">(</span><span style="color: #81A1C1">||</span><span style="color: #D8DEE9FF"> </span><span style="color: #88C0D0">slice_series</span><span style="color: #ECEFF4">(</span><span style="color: #81A1C1">&#x26;</span><span style="color: #D8DEE9">s</span><span style="color: #ECEFF4">,</span><span style="color: #D8DEE9FF"> </span><span style="color: #B48EAD">100</span><span style="color: #ECEFF4">,</span><span style="color: #D8DEE9FF"> </span><span style="color: #B48EAD">200</span><span style="color: #ECEFF4">)));</span></span>
<span class="line"><span style="color: #ECEFF4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #88C0D0; font-style: italic">criterion_group!</span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9">benches</span><span style="color: #ECEFF4">,</span><span style="color: #D8DEE9FF"> </span><span style="color: #D8DEE9">criterion_benchmark</span><span style="color: #ECEFF4">);</span></span>
<span class="line"><span style="color: #88C0D0; font-style: italic">criterion_main!</span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9">benches</span><span style="color: #ECEFF4">);</span></span></code></pre>
<p>It turns out that <code>criterion</code> cannot be used in conjunction with <code>benchmark-actions</code> and had to abandon the <code>criterion</code> library for doing the nightly builds with <code>#[bench]</code> instead.</p>
<pre is:raw="" class="astro-code" style="background-color: #2e3440ff; overflow-x: auto;"><code><span class="line"><span style="color: #5E81AC">#[bench]</span></span>
<span class="line"><span style="color: #81A1C1">fn</span><span style="color: #D8DEE9FF"> </span><span style="color: #88C0D0">slice_a_series_of_size_1000</span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9">b</span><span style="color: #81A1C1">:</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">&#x26;mut</span><span style="color: #D8DEE9FF"> </span><span style="color: #8FBCBB">Bencher</span><span style="color: #ECEFF4">)</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">{</span></span>
<span class="line"><span style="color: #D8DEE9FF">	</span><span style="color: #81A1C1">fn</span><span style="color: #D8DEE9FF"> </span><span style="color: #88C0D0">slice_series</span><span style="color: #ECEFF4">(</span><span style="color: #D8DEE9">s</span><span style="color: #81A1C1">:</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">&#x26;</span><span style="color: #D8DEE9FF">series</span><span style="color: #81A1C1">::</span><span style="color: #8FBCBB">Series</span><span style="color: #ECEFF4">&#x3C;</span><span style="color: #8FBCBB">i32</span><span style="color: #ECEFF4">>)</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">{</span></span>
<span class="line"><span style="color: #D8DEE9FF">		</span><span style="color: #81A1C1">let</span><span style="color: #D8DEE9FF"> </span><span style="color: #D8DEE9">_</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">&#x26;</span><span style="color: #D8DEE9">s</span><span style="color: #ECEFF4">[</span><span style="color: #B48EAD">1</span><span style="color: #81A1C1">..</span><span style="color: #B48EAD">3</span><span style="color: #ECEFF4">];</span></span>
<span class="line"><span style="color: #D8DEE9FF">	</span><span style="color: #ECEFF4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D8DEE9FF">	</span><span style="color: #D8DEE9">b</span><span style="color: #81A1C1">.</span><span style="color: #88C0D0">iter</span><span style="color: #ECEFF4">(</span><span style="color: #81A1C1">||</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">{</span></span>
<span class="line"><span style="color: #D8DEE9FF">		</span><span style="color: #81A1C1">let</span><span style="color: #D8DEE9FF"> </span><span style="color: #D8DEE9">vec</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">(</span><span style="color: #B48EAD">0</span><span style="color: #81A1C1">..</span><span style="color: #B48EAD">1000</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">.</span><span style="color: #88C0D0">map</span><span style="color: #ECEFF4">(</span><span style="color: #81A1C1">|</span><span style="color: #D8DEE9">v</span><span style="color: #81A1C1">|</span><span style="color: #D8DEE9FF"> </span><span style="color: #D8DEE9">v</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">+</span><span style="color: #D8DEE9FF"> </span><span style="color: #B48EAD">1000</span><span style="color: #ECEFF4">)</span><span style="color: #81A1C1">.</span><span style="color: #88C0D0">collect</span><span style="color: #81A1C1">::</span><span style="color: #ECEFF4">&#x3C;</span><span style="color: #8FBCBB">Vec</span><span style="color: #ECEFF4">&#x3C;</span><span style="color: #8FBCBB">i32</span><span style="color: #ECEFF4">>>();</span></span>
<span class="line"><span style="color: #D8DEE9FF">		</span><span style="color: #81A1C1">let</span><span style="color: #D8DEE9FF"> </span><span style="color: #D8DEE9">s</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">=</span><span style="color: #D8DEE9FF"> series</span><span style="color: #81A1C1">::</span><span style="color: #8FBCBB">Series</span><span style="color: #81A1C1">::</span><span style="color: #88C0D0">new</span><span style="color: #ECEFF4">(</span><span style="color: #8FBCBB">String</span><span style="color: #81A1C1">::</span><span style="color: #88C0D0">from</span><span style="color: #ECEFF4">(</span><span style="color: #ECEFF4">"</span><span style="color: #A3BE8C">hej</span><span style="color: #ECEFF4">"</span><span style="color: #ECEFF4">),</span><span style="color: #D8DEE9FF"> </span><span style="color: #D8DEE9">vec</span><span style="color: #ECEFF4">,</span><span style="color: #D8DEE9FF"> </span><span style="color: #8FBCBB">None</span><span style="color: #ECEFF4">);</span></span>
<span class="line"><span style="color: #D8DEE9FF">		</span><span style="color: #81A1C1">for</span><span style="color: #D8DEE9FF"> </span><span style="color: #D8DEE9">_</span><span style="color: #D8DEE9FF"> </span><span style="color: #81A1C1">in</span><span style="color: #D8DEE9FF"> </span><span style="color: #B48EAD">0</span><span style="color: #81A1C1">..</span><span style="color: #B48EAD">1000</span><span style="color: #D8DEE9FF"> </span><span style="color: #ECEFF4">{</span></span>
<span class="line"><span style="color: #D8DEE9FF">			test</span><span style="color: #81A1C1">::</span><span style="color: #88C0D0">black_box</span><span style="color: #ECEFF4">(</span><span style="color: #88C0D0">slice_series</span><span style="color: #ECEFF4">(</span><span style="color: #81A1C1">&#x26;</span><span style="color: #D8DEE9">s</span><span style="color: #ECEFF4">));</span><span style="color: #616E88"> // spooky black_box ğŸ‘»</span></span>
<span class="line"><span style="color: #D8DEE9FF">		</span><span style="color: #ECEFF4">}</span></span>
<span class="line"><span style="color: #D8DEE9FF">	</span><span style="color: #ECEFF4">});</span></span>
<span class="line"><span style="color: #ECEFF4">}</span></span></code></pre>
<p>Just when I thought I had cleverly outwitted theÂ Rust compilerâ€™s optimizations by benchmarking myÂ <code>slice_series</code>Â function. Rust discarded theÂ redundant function calls, yielding a benchmark ofÂ <code>0 ns/iter</code>Â - infinite speed! â™¾ï¸</p>
<p>Running this benchmark does however pose a problem as rust has optimization strategies for their compiler to disgard the function calls of slicing the series to only do it once. DAMN you rust toooo smooth. Instead one has to invoke a <code>black_box</code> call on top of the function being tested. The <code>test::black_box</code> function is an identity function that hints to the compiler to be maximally pessimistic about what <code>black_box</code> could do. All together we got out first benchmark test that actually did not have <code>0 ns/iter</code> but <code>412 ns/iter</code>, resulting in infinite performance regression ğŸ¤£.</p>
<p><img src="/assets/rust-infinite-perf-regression.png" alt="perf-regression"></p>
<p>I integratedÂ benchmark testingÂ into theÂ continuous integrationÂ (CI) process for my project. This practice of including performance testing as part of CI is known as performance-driven development. MostÂ programming languagesÂ and critical systems where performance is crucial (e.g. financial systems) implement this.</p>
<p>This allows allÂ team membersÂ to detectÂ performance regressionsÂ that may arise from newly added features or bug fixes. We used theÂ <code>benchmark-action</code>Â GitHub Action, which is specifically designed to run benchmarks in CI. After some trial and error, I got it working by setting up aÂ <code>gh-pages</code>Â branch in the repository and adding aÂ <code>dev/bench</code>Â folder on that branch.</p>
<p><strong>Note:</strong>Â It was important to create theÂ <code>gh-pages</code>Â branch andÂ <code>dev/bench</code>Â directory because theÂ <code>output.txt</code>Â file generated byÂ <code>benchmark-action</code>Â expects those to exist in order to store theÂ benchmark results. (I should have figured that out more quickly!)</p>
<p>Finally, to track performance over time and detect regressions, I set up a GitHub Action to runÂ <code>bench</code>Â benchmarks on every push and save the results. TheÂ <a href="https://github.com/marketplace/actions/github-action-for-benchmark" target="_blank" rel="nofollow"><code>benchmark-action</code></a>Â made this process straightforward.</p>
<p><img src="/assets/blog/rust-benchmark.png" alt="benchmark"></p>
<p>You can see the currentÂ benchmark resultsÂ forÂ <code>rustybucket</code>Â in theÂ <a href="https://eleijonmarck.github.io/rustybucket/dev/bench" target="_blank" rel="nofollow">GitHub Pages site</a>Â for the project, or follow the development @ <a href="https://github.com/eleijonmarck/rustybucket" target="_blank" rel="nofollow">https://github.com/eleijonmarck/rustybucket</a>.</p>
<p>This is the end of part 1 where we make rustybucket the bucket for data that is rusty better.</p>
<h4 id="the-well-used-bucket">The Well-Used Bucket</h4>
<p>I would like to share a tale about a bucket that served its purpose admirably, though not without signs of wear and tear.</p>
<p>When it was first acquired, the bucket was gleaming and spotless. However, as time went on and the bucket was utilized repeatedly, it inevitably deteriorated. Its once-shiny exterior became weathered and discolored, coated in a layer of dirt and grime. Rust invaded the metal, leavingÂ orange stainsÂ that could not be scrubbed away.</p>
<p>If the bucket is not cleaned regularly, removing the built-up dust and debris and treating the rust before it spreads, it will soon become useless. What was once a perfectly suitable bucket will have transformed into aÂ rusted relic, suitable only for theÂ scrap heap.</p>
    </article>
    <hr class="astro-4SN4ZG3R">
    <div class="astro-2JILUK5E">
  <img src="/assets/eric-small.png" alt="Headshot of Maxi Ferreira" class="astro-2JILUK5E">
  <p class="astro-2JILUK5E">
    Hi, I'm <strong class="astro-2JILUK5E">Eric</strong>. I'm a software engineer and data scientist based in Lisbon.
    You can follow me on <a href="https://www.twitter.com/eleijonmarck" target="_blank" class="astro-2JILUK5E">Twitter</a>,
    see some of my work on <a href="https://www.github.com/eleijonmarck" target="_blank" class="astro-2JILUK5E">GitHub</a>,
  </p>
</div>
  </div>
    </main>

    <footer class="astro-SZ7XMLTE">
  <span class="astro-SZ7XMLTE">
    &copy; 2023 A* information.
    Powered by <a href="https://astro.build" target="_blank" rel="noopener" class="astro-SZ7XMLTE">Astro</a>.
    Template by <a href="https://www.twitter.com/Charca" target="_blank" rel="noopener" class="astro-SZ7XMLTE">Maxi Ferreira</a>.
  </span>
</footer>
  </div>
</body></html>